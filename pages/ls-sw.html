<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../style.css" />
		<title>Long sleeve + Sweatpants</title>
		<style>
			.shopify-buy--visually-hidden { display:none!important; }
			.shopify-buy-frame, .shopify-buy__cart-toggle { padding:0px!important; margin:0px!important; display:inline!important; height:auto!important;line-height:1px!important;top:0!important;bottom:0!important; border-radius:0px!important }
			@media screen and (max-width: 680px) {				
				.shopify-buy__layout-horizontal:not(.no-image) .shopify-buy__product__variant-selectors {
					margin-left: 0px !important;
				}
			}
		</style>
        		<!-- Meta Pixel Code -->
<script>
	!function(f,b,e,v,n,t,s)
	{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
	n.callMethod.apply(n,arguments):n.queue.push(arguments)};
	if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
	n.queue=[];t=b.createElement(e);t.async=!0;
	t.src=v;s=b.getElementsByTagName(e)[0];
	s.parentNode.insertBefore(t,s)}(window, document,'script',
	'https://connect.facebook.net/en_US/fbevents.js');
	fbq('init', '703071995395077');
	fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none"
	src="https://www.facebook.com/tr?id=703071995395077&ev=PageView&noscript=1"
	/></noscript>
	<!-- End Meta Pixel Code -->
	</head>
	<body>
		<header class="header-container">
			<nav class="navbar">
				<button class="burger-menu" id="burger-menu">
					<img src="../assets/icons/burger.svg" alt="Menu" />
				</button>
				<button class="close-menu" id="close-menu">
					<img
						src="../assets/icons/close.svg"
						alt="Close"
						width="20"
						height="20"
					/>
				</button>
				<ul class="nav-list" id="nav-list">
					<li class="nav-item">
						<a href="../index.html">shop</a>
					</li>
					<li class="nav-item">
						<a href="https://www.instagram.com/immigr.nt/">instagram</a>
					</li>
					<li class="nav-item">
						<a href="#" id="cart-toggle"></a>
					</li>
				</ul>
				<a  href="../index.html">
					<img class="logo" src="../assets/icons/immigr-nt.svg" alt="">
				</a>
			</nav>
		</header>
		<main class="product-container">
			<div class="product-page">
				<div class="product-info product-info-longsleeve">
					<h2 class="product-info_heading">IMMIGRNT</h2>
					<p class="product-info_desc">Long sleeve + Sweatpants</p>
                    <div class="product-info_details">
                        <p>Longsleeve:</p>
                        <ul>
                            <li>Slim fit</li>
                            <li>Durag immitation hood</li>
                            <li>Hood logo embroidery</li>
                            <li>Unfinished edges</li>
                        </ul>
                        <p>Sweatpants:</p>
                        <ul>
                            <li>Wide fit</li>
                            <li>Logo embroidery  on the back pocket</li>
                            <li>2 leg opening pockets</li>
                            <li>Pant laces</li>
                            <li>Low waistband</li>
                            <li>French terry cotton</li>
                        </ul>
                    </div>
					<p>Color: White</p>
					<p>Fabric: 100% cotton</p>
					<p>Made in Poland</p>
				</div>

				<div class="product-slider product-image">
					<div class="prev" onclick="changeSlide(-1)">
						<img src="../assets/icons/left-arrow.svg" alt="Previous">
					</div>
					<div class="slider">
						<div class="slider-container">
							<img src="../assets/images/ls-sweatpants_1.jpg" alt="Clean slate long sleeve + sweatpants">
							<img src="../assets/images/ls-sweatpants_2.jpg" alt="Clean slate long sleeve + sweatpants">
							<img src="../assets/images/ls-sweatpants_3.jpg" alt="Clean slate long sleeve + sweatpants">
							<img src="../assets/images/ls-sweatpants_4.jpg" alt="Clean slate long sleeve + sweatpants">
						</div>
					</div>
					<div class="next" onclick="changeSlide(1)">
						<img src="../assets/icons/right-arrow.svg" alt="Next">
					</div>
				</div>

				<div class="purchase-info">
					<div class="price">
                        <div class="price-discount">
							<p>€179</p>
							<p>€218</p>
						</div>
						<span>Tax included</span>
					</div>
					<div id="product-component-1743620564220"></div>
					<div class="model-info">
						<p>Model is 180 cm and wears size 1</p>
						<a id="modal-window" href="#">Measurements</a>
					</div>
                    <p class="shipping-info">Shipping up to 1 week </p>
				</div>
			</div>

		</main>
		<footer>
			<p>© 2025 immigrnt. All rights reserved. <a href="./tnc.html">Terms & Conditions.</a></p>
		</footer> 
		<div class="modal" id="measurementsModal">
			<div class="modal-content">
				<h2>Clean Slate measurements</h2>
				<button class="modal-close"><img src="../assets/icons/close.svg" alt="Close buttton"></button>
				<div class="measurements">
                    <table class="measurements-table">
                        <h3>Long sleeve</h2>
                        <tr>
                            <th>size</th>
                            <th>1</th>
                            <th>2</th>
                            <th>3</th>
                        </tr>
                        <tr>
                            <td>length</td>
                            <td>59</td>
                            <td>62</td>
                            <td>63</td>
                        </tr>
                        <tr>
                            <td>shoulders</td>
                            <td>38</td>
                            <td>41</td>
                            <td>48</td>
                        </tr>
                        <tr>
                            <td>sleeve</td>
                            <td>70</td>
                            <td>70</td>
                            <td>72</td>
                        </tr>
                        <tr>
                            <td>collar</td>
                            <td>16</td>
                            <td>18</td>
                            <td>20</td>
                        </tr>
                    </table>
                    <table class="measurements-table">
                        <h3>Sweatpants</h2>
						<tr>
							<th>size</th>
							<th>1</th>
							<th>2</th>
							<th>3</th>
						</tr>
						<tr>
							<td>length</td>
							<td>100</td>
							<td>108</td>
							<td>112</td>
						</tr>
						<tr>
							<td>Waist</td>
							<td>29-41</td>
							<td>30-42</td>
							<td>40-52</td>
						</tr>
						<tr>
							<td>hips</td>
							<td>49</td>
							<td>50</td>
							<td>55</td>
						</tr>
						<tr>
							<td>leg opening</td>
							<td>34</td>
							<td>35</td>
							<td>36</td>
						</tr>
					</table>
                    <h3>1 = XS/S   2=M   3=L/XL </h2>
					<p>Measurements in cm*</p>
				</div>
			</div>
		</div>
	</body>
	<script defer src="../scripts/script.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
(function () {
  "use strict";

  // prevent double run if you accidentally include it twice
  if (window.__IMMIGR_PRODUCT_INIT__) return;
  window.__IMMIGR_PRODUCT_INIT__ = true;

  /* ---------------------------- Config ---------------------------- */
  const SHOPIFY_DOMAIN = "a7cpqd-t6.myshopify.com";
  const STOREFRONT_TOKEN = "499807ad1d9398ef053c159d436b2a71";
  const DEFAULT_EUR_MARKET_COUNTRY = "BE"; // fallback market (EUR)
  const BUY_BUTTON_SDK = "https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js";

  const PRODUCT_ID = "15097628852611";
  const PRODUCT_NODE_ID = "product-component-1743620564220";
  const CART_TOGGLE_NODE_ID = "cart-toggle"; // your header link

  /* --------------------------- Utilities -------------------------- */

  // ?forceCountry=PL (or UA/BE) for testing
  function overrideFromQuery() {
    const m = location.search.match(/[?&]forceCountry=([A-Z]{2})/);
    return m ? m[1] : null;
  }

  // Wait until a selector appears in DOM
  function waitForElement(selector, root = document) {
    return new Promise((resolve) => {
      const el = root.querySelector(selector);
      if (el) return resolve(el);
      const mo = new MutationObserver(() => {
        const found = root.querySelector(selector);
        if (found) { mo.disconnect(); resolve(found); }
      });
      mo.observe(root, { childList: true, subtree: true });
    });
  }

  // Geo detection with fallbacks; respects overrides
  async function getCountryCode() {
    try {
      const forced = overrideFromQuery() || localStorage.getItem("forceCountry");
      if (forced) {
        console.log("[geo] forced country:", forced);
        return forced.toUpperCase();
      }
    } catch (e) {
      console.warn("[geo] override check failed:", e);
    }

    const providers = [
      { url: "https://ipwho.is/", pick: (j) => j && j.country_code },
      { url: "https://ipapi.co/json/", pick: (j) => j && j.country_code },
      { url: "https://get.geojs.io/v1/ip/geo.json", pick: (j) => j && j.country_code },
      { url: "https://geolocation-db.com/json/", pick: (j) => j && j.country_code },
    ];

    for (const p of providers) {
      try {
        const r = await fetch(p.url, { cache: "no-store", headers: { Accept: "application/json" } });
        console.log("[geo] fetch", p.url, "status:", r.status);
        if (!r.ok) continue;
        const j = await r.json();
        console.log("[geo] response", p.url, j);
        const cc = p.pick(j);
        if (cc && /^[A-Za-z]{2}$/.test(cc)) return cc.toUpperCase();
      } catch (e) {
        console.warn("[geo] provider failed:", p.url, e);
      }
    }

    console.warn("[geo] all providers failed — using default");
    return null;
  }

  // map to markets you support (PL, UA → themselves; others → EUR market country)
  function pickBuyerCountry(cc) {
    if (cc === "PL") return "PL";
    if (cc === "UA") return "UA";
    return DEFAULT_EUR_MARKET_COUNTRY;
  }

  // visual formatting for product/cart UI
  function moneyFormatForCountry(cc) {
    switch (cc) {
      case "PL": return "{{amount_with_comma_separator}}\u00A0zł"; // 1.234,56 zł
      case "UA": return "₴{{amount_with_comma_separator}}";       // ₴1.234,56
      default:   return "€{{amount_with_comma_separator}}";       // €1.234,56
    }
  }

  // make the cart’s little currency code badge match our market (or hide it)
  function setCartCurrencyBadge(cc) {
    const map = { PL: "PLN", UA: "UAH" };
    const code = map[cc] || "EUR";

    const setNow = () => {
      const el =
        document.querySelector(".shopify-buy__currency") ||
        document.querySelector('[data-element="cart.currency"]');
      if (el) { el.textContent = code; return true; }
      return false;
    };

    if (!setNow()) {
      new MutationObserver((_, obs) => { if (setNow()) obs.disconnect(); })
        .observe(document.body, { childList: true, subtree: true });
    }
  }

  // Create a Storefront Cart with buyerIdentity.countryCode and redirect to checkout
  async function forceCheckoutCurrency(buyerCC, cartComponent) {
    const items =
      cartComponent && cartComponent.model && cartComponent.model.lineItems
        ? cartComponent.model.lineItems
        : [];
    if (!items.length) { alert("Your cart is empty."); return; }

    const lines = items.map((li) => ({
      merchandiseId: li.variant.id, // GraphQL GID
      quantity: li.quantity,
    }));

    const mutation = `
      mutation CreateCart($lines:[CartLineInput!], $buyer: CartBuyerIdentityInput) {
        cartCreate(input:{ lines: $lines, buyerIdentity: $buyer }) {
          cart { checkoutUrl }
          userErrors { message }
        }
      }
    `;

    try {
      const res = await fetch(`https://${SHOPIFY_DOMAIN}/api/2025-01/graphql.json`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
          "X-Shopify-Storefront-Access-Token": STOREFRONT_TOKEN,
        },
        body: JSON.stringify({ query: mutation, variables: { lines, buyer: { countryCode: buyerCC } } }),
      });
      const json = await res.json();
      console.log("[checkout] cartCreate response:", json);

      const url = json?.data?.cartCreate?.cart?.checkoutUrl;
      if (!url) {
        const msg = (json?.data?.cartCreate?.userErrors || []).map((e) => e.message).join(", ") || "Unknown error";
        alert("Could not start checkout: " + msg);
        return;
      }
      window.location.href = url;
    } catch (err) {
      console.error("[checkout] cartCreate failed:", err);
      alert("Something went wrong starting checkout.");
    }
  }

  // ensure the Buy Button SDK is present
  function ensureBuyButtonSdk(cb) {
    if (window.ShopifyBuy && window.ShopifyBuy.UI) return cb();
    var script = document.createElement("script");
    script.async = true;
    script.src = BUY_BUTTON_SDK;
    (document.head || document.body).appendChild(script);
    script.onload = cb;
  }

  /* ------------------------ Main initialization ------------------------ */

  function ShopifyBuyInit() {
    (async () => {
      const rawCC = (await getCountryCode()) || DEFAULT_EUR_MARKET_COUNTRY;
      const buyerCC = pickBuyerCountry(rawCC);
      const moneyFmt = moneyFormatForCountry(buyerCC);
      console.log("[init] geo:", { rawCC, buyerCC, moneyFmt });

      const client = ShopifyBuy.buildClient({
        domain: SHOPIFY_DOMAIN,
        storefrontAccessToken: STOREFRONT_TOKEN,
      });

      ShopifyBuy.UI.onReady(client).then(async function (ui) {
        // 1) Create the CART explicitly so we can hook checkout
        const toggleNode = document.getElementById(CART_TOGGLE_NODE_ID);
        const cart = ui.createComponent("cart", {
          toggles: toggleNode ? [{ node: toggleNode }] : [],
          moneyFormat: moneyFmt,
          options: {
            cart: {
              styles: {
                button: {
                  ":hover": { color: "#222222", "background-color": "#fff", border: "1px solid #222222" },
                  "background-color": "#222222",
                },
                title: { color: "#252525" },
                header: { color: "#252525" },
                lineItems: { color: "#252525" },
                subtotalText: { color: "#252525" },
                subtotal: { color: "#252525" },
                notice: { color: "#252525" },
                currency: { color: "#252525" },
                close: { color: "#252525", ":hover": { color: "#252525" } },
                empty: { color: "#252525" },
                noteDescription: { color: "#252525" },
                discountText: { color: "#252525" },
                discountIcon: { fill: "#252525" },
                discountAmount: { color: "#252525" },
              },
              text: {
                title: "CART",
                total: "TOTAL",
                empty: "BUY SUM!",
                notice: "",
                button: "TO CHECKOUT!",
              },
              popup: false,
            },
            toggle: {
              sticky: false,
              iframe: false,
              templates: {
                icon: "",
                count: '<span class="{{data.classes.toggle.count}}" data-element="toggle.count">cart ({{data.count}})</span>',
              },
            },
          },
        });

        // fix the currency badge to match PLN/UAH/EUR
        setCartCurrencyBadge(buyerCC);

        // 2) Create the PRODUCT (uses same moneyFormat)
        ui.createComponent("product", {
          id: PRODUCT_ID,
          node: document.getElementById(PRODUCT_NODE_ID),
          moneyFormat: moneyFmt,
          options: {
            product: {
              styles: {
                display: "flex",
                button: {
                  "text-transform": "uppercase !important",
                  width: "100%",
                  ":hover": { "background-color": "#ffffff", "color": "#000000" },
                  "background-color": "#000000",
                  padding: "10px",
                  border: "1px solid #000000",
                  ":focus": { "background-color": "#ffffff", "color": "#000000" },
                },
                buttonWrapper: { "margin-left": "0px !important" },
                options: { "margin-left": "0px !important" },
              },
              layout: "horizontal",
              contents: {
                img: false,
                imgWithCarousel: false,
                description: false,
                title: false,
                price: false,
                options: true,
              },
              text: { button: "Add to bag" },
            },
          },
        });

        // 3) Intercept the checkout button to force market-specific checkout
        const buttonSelector =
          ".shopify-buy__btn--cart-checkout, .shopify-buy__cart-checkout-button";
        const checkoutBtn = await waitForElement(buttonSelector);
        checkoutBtn.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          forceCheckoutCurrency(buyerCC, cart);
        });

        console.log("[init] product + cart ready; checkout hooked");
      });
    })();
  }

  // Load SDK and run
  if (window.ShopifyBuy && window.ShopifyBuy.UI) {
    ShopifyBuyInit();
  } else {
    ensureBuyButtonSdk(ShopifyBuyInit);
  }
})();
 /*]]>*/
</script>
</html>
